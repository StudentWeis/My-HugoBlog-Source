---
title: 2021·电赛·流水账
date: 2021-11-11T20:20:52+08:00
---

前些天参加了 2021 年全国大学生电子设计大赛 TI 杯，虽然最后结果不怎么样，可是过程也是拼尽全力、跌宕起伏，写篇流水账，记录一下那些天的心情。

<!-- more -->

**2021电赛日记流水账**

本来是打算花两个星期来准备今年的全国大学生电子设计大赛的，可是由于临时被叫去帮忙做别的事情，最后只在 11.3 留出了一天来准备。之前根据元件清单预测控制类题目是球形机器人，后来改成了球上放平衡板，并且猜测题目会强制使用 TI 公司芯片，所以提前学了 MSP432 的使用。学习了 IO、PWM、Timer、UART、I2C 等外设的使用，熬夜到一点多🕐画完了底板的 PCB。

第二天早晨醒来，一看手机整个人都不好了，猜题完全错误❌。控制类题目只是单纯的小车控制，结合了图像识别，和球、板完全没关系，而且还不限制 MCU。没办法，只能硬着头皮从零开始了。找出以前剩下的小车模型，打开 CubeMX，重拾 STM32F1 HAL 库编程，还好没有忘记。队友在学 OpenMV 的使用，我在调底层 MCU 的控制驱动，整个过程都很流畅，第一天我完成了各项底层驱动的配置。

可是当 11.5 我们第一次软硬件联调测试 PWM 的时候却发现：小车前轮不转。我们考虑了各种可能性：L298N 坏了、电机坏了、程序不对、线坏了，调了整整一下午，最后才发现是 MCU 坏了。心情很崩溃，但也没什么办法，还得向前走不是？经过一番努力，当天晚上我们第一次结合 OpenMV 完成了小车寻迹前进，使用 PID 控制算法，效果很好，悬着的心终于落实了。不过我的正反转程序和 UART 接收程序有些问题，正反转没有考虑 PWM 的互补，UART 没有考虑丢失数据的情况。不过不管那么多了，电赛的前两天就这样过去了。

第三天上午我们优化了 UART 的接收程序，避免了数据丢失问题；优化了电机正反转控制函数，下午搞定了蓝牙透传。当两个蓝牙串口成功通讯的时候，我兴奋地大叫了出来。特别匆忙地准备拼搭第二辆车，找王达老师借电池，没有，我就去鞍山西道上找电子元件店，找了三家店后终于找到了。淋着小雨🌧，历经半个小车疯狂骑车，我赶回了实验室。却又收到了不好的消息，队友的 OpenMV 不太行，识别不了数字。

我便开始和他一起学 OpenMV，想着帮忙解决问题，我们决定晚上通宵，一定要把小车做出来。由于 OpenMV 版本不对，不能使用 Tensorflow Lite，我们就打算回退固件去使用旧版本的 Lenet 网络识别数字。先使用了官方推荐的 DFU 程序，可是那一段动画般的进度条不断地将我们欺骗，最终成功地把我们的板子变成了一块砖。心态真的彻底崩了，又搭进去一块板子。

不行，不能放弃，一定要再试试。查了好多博客之后终于找到了解决问题的方式，使用 STM32CubeProgrammer 来完成固件的擦除和烧录。我赶紧就去 ST 官网下载，需要注册，注册又让我头大，密码的设置要求极其诡异，花了十多分钟时间才搞定。不过方法确实有效，板子被救活了，之后也成功地调用了 Lenet 网络。可是，识别效果很差，因为我们没有自己训练网络，预训练模型识别效果真的相当差。这时已经凌晨四点多了，这一晚上，EDG 赢了，天津下雪了，我们的小车还是那样。站在综合实验楼的六层，望着卫津路上的偶尔闪过的车光，我叹了一口气，害，就这样吧，睡了。

最后一天我们目标非常明确，只做第一问，把最简单的那一部分搞定，重拾模式匹配的方案识别数字 1 和 2。我负责 OpenMV 的 main 函数，队友负责写识别函数，最终也终于完成了效果。最后就是把所有的东西粘好，一架完整的小车就出世了。

---

对啦，中间还有一个小插曲。由于我的疏忽，将一个金属盖子放在小车顶端，不小心将板子短路了。那是我第一次简单板子短路烧毁。伴随着优雅的音乐🎶（因为我加了 MP3 模块和喇叭），STM32F103 缓缓地冒出一股青烟，还有几声噼啪作响的火花🔥。不过换了一块板子之后就好了。中间还有无数次的小错误，接错线啦、线坏啦、程序错啦等等等等。

不过不管怎么样，电赛终于结束了。虽然身心俱疲，可也长了很多经验，学会了 CAD 切割亚克力板、蓝牙透传、OpenMV 基本使用以及固件库自定义烧录、CubeMX 实战配置、使用 ST-LINK SWD 烧录程序、PWM 正反转控制互补、printf 的 microLib 选择、UART 单字节接受特征码避免数据丢失等等、示波器 10x 输入导致的 PWM 信号上下双峰。

也算是值得了。

![I0a2rt.jpg](https://z3.ax1x.com/2021/11/11/I0a2rt.jpg)

